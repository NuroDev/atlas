name: ðŸ’¡ Docs

on: [push]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1

    - name: Toolchain
      uses: actions-rs/toolchain@v1
      with:
        profile: minimal
        toolchain: stable
        override: true
        components: [rustfmt, clippy]

    - name: Format
      uses: actions-rs/cargo@v1
      continue-on-error: true
      with:
        command: fmt
        args: --all -- --check

    - name: Lint
      uses: actions-rs/cargo@v1
      with:
        command: clippy
        args: -- -D warnings

    - name: Check
      uses: actions-rs/cargo@v1
      with:
        command: check
        args: --verbose --all

    - name: Build
      uses: actions-rs/cargo@v1
      with:
        command: doc
        args: --verbose --no-deps --features vulkan

    - name: Make Public Directory
      run: mkdir docs/public/

    - name: Move Build
      run: mv -v target/doc/* docs/public/

    - name: Deploy
      uses: amondnet/now-deployment@v1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        zeit-token: ${{ secrets.ZEIT_TOKEN }}
        now-args: '--prod ./docs'
